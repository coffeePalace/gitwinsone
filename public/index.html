<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WinsOne</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>

  <h1>WinsOne</h1>
  <p>Adventure & experiential travel discovery platform</p>

  <script>
    (async function () {

      /* ---------- CONFIG (CONFIRMED WORKING) ---------- */
      const API_URL =
        "https://xt9h7yfrn4.execute-api.ap-south-1.amazonaws.com/platformlogstage/test";

      const API_KEY = "MW-SECRET-2026-9f3cX";

      /* ---------- VISITOR ID (PERSISTENT) ---------- */
      const VISITOR_KEY = "mw_visitor_id";
      let visitorId = localStorage.getItem(VISITOR_KEY);

      if (!visitorId) {
        visitorId = crypto.randomUUID();
        localStorage.setItem(VISITOR_KEY, visitorId);
      }

      /* ---------- DATETIME FORMAT: yyyy-mm-dd hh:mm:ss ---------- */
      function formatDateTime(date) {
        const pad = (n) => n.toString().padStart(2, "0");
        return (
          date.getFullYear() + "-" +
          pad(date.getMonth() + 1) + "-" +
          pad(date.getDate()) + " " +
          pad(date.getHours()) + ":" +
          pad(date.getMinutes()) + ":" +
          pad(date.getSeconds())
        );
      }

      const visitDateTime = formatDateTime(new Date());

      /* ---------- GEO LOOKUP (FREE, CLIENT-SIDE) ---------- */
      let city = "unknown";
      let country = "unknown";

      try {
        const geoRes = await fetch("https://ipapi.co/json/");
        const geoData = await geoRes.json();
        city = geoData.city || "unknown";
        country = geoData.country_name || "unknown";
      } catch (e) {
        // silent fail – never block page load
      }

      /* ---------- PAYLOAD ---------- */
      const payload = {
        visitor_id: visitorId,
        visit_datetime: visitDateTime,
        visitor_city: city,
        visitor_country: country,
        platform_source: "vercel",
        platform_source_page: "vercel_homepage"
      };

      /* ---------- SEND TO AWS ---------- */
      try {
        await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-api-key": API_KEY
          },
          body: JSON.stringify(payload)
        });
      } catch (err) {
        // do nothing – analytics must never break UX
      }

    })();
  </script>

</body>
</html>
