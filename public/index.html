<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WinsOne</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>

  <h1>WinsOne</h1>
  <p>Adventure & experiential travel discovery platform</p>

  <script>
    (function () {

      /* ---------- CONFIG (CURRENT AWS API) ---------- */
      const API_URL =
        "https://c7sw1qe043.execute-api.ap-south-1.amazonaws.com/log-visitor";

      const API_KEY = "MW-SECRET-2026-9f3cX";

      /* ---------- VISITOR ID ---------- */
      const VISITOR_KEY = "mw_visitor_id";
      let visitorId = localStorage.getItem(VISITOR_KEY);

      if (!visitorId) {
        visitorId = crypto.randomUUID();
        localStorage.setItem(VISITOR_KEY, visitorId);
      }

      /* ---------- DATETIME yyyy-mm-dd hh:mm:ss ---------- */
      function formatDateTime(date) {
        const pad = (n) => n.toString().padStart(2, "0");
        return (
          date.getFullYear() + "-" +
          pad(date.getMonth() + 1) + "-" +
          pad(date.getDate()) + " " +
          pad(date.getHours()) + ":" +
          pad(date.getMinutes()) + ":" +
          pad(date.getSeconds())
        );
      }

      const visitDateTime = formatDateTime(new Date());

      /* ---------- DEFAULT GEO ---------- */
      let city = "unknown";
      let country = "unknown";

      /* ---------- PAYLOAD ---------- */
      const payload = {
        visitor_id: visitorId,
        visit_datetime: visitDateTime,
        visitor_city: city,
        visitor_country: country,
        platform_source: "vercel",
        platform_source_page: "vercel_homepage"
      };

      /* ---------- SEND TO AWS (DO NOT BLOCK) ---------- */
      fetch(API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-api-key": API_KEY
        },
        body: JSON.stringify(payload)
      }).catch(() => {});

      /* ---------- OPTIONAL GEO ENRICH (NON-BLOCKING) ---------- */
      fetch("https://ipapi.co/json/")
        .then(r => r.json())
        .then(d => {
          payload.visitor_city = d.city || "unknown";
          payload.visitor_country = d.country_name || "unknown";

          fetch(API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "x-api-key": API_KEY
            },
            body: JSON.stringify(payload)
          }).catch(() => {});
        })
        .catch(() => {});

    })();
  </script>

</body>
</html>
